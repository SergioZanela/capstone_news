{% extends "base.html" %}

{% block title %}{{ article.title }} | Capstone News{% endblock %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">
      <article class="card shadow-sm border-0">
        <div class="card-body p-4 p-md-5">
          <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
            <a href="{% url 'article_list' %}" class="btn btn-outline-secondary btn-sm">
              ← Back to Articles
            </a>

            <div class="d-flex gap-2">
              {% if article.approved %}
                <span class="badge text-bg-success">Approved</span>
              {% else %}
                <span class="badge text-bg-warning">Pending</span>
              {% endif %}

              {% if article.publisher %}
                <span class="badge text-bg-light border">{{ article.publisher.name }}</span>
              {% else %}
                <span class="badge text-bg-light border">Independent</span>
              {% endif %}
            </div>
          </div>

          <h1 class="display-6 fw-bold mb-3">{{ article.title }}</h1>

          <p class="text-muted mb-4">
            By <strong>{{ article.author.username }}</strong>
            • Created {{ article.created_at|date:"d M Y, H:i" }}
            {% if article.approved and article.approved_at %}
              • Approved {{ article.approved_at|date:"d M Y, H:i" }}
            {% endif %}
          </p>

          <hr />

          {% if is_reader and article.approved %}
            <div class="mb-4">
              <h2 class="h6 text-uppercase text-muted mb-3">Subscriptions</h2>

              <div class="d-flex flex-wrap gap-2">
                {% if is_subscribed_to_journalist %}
                  <form method="post" action="{% url 'unsubscribe_journalist_from_article' article.pk %}" class="m-0">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      Unsubscribe from journalist {{ article.author.username }}
                    </button>
                  </form>
                {% else %}
                  <form method="post" action="{% url 'subscribe_journalist_from_article' article.pk %}" class="m-0">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-primary">
                      Subscribe to journalist {{ article.author.username }}
                    </button>
                  </form>
                {% endif %}

                {% if article.publisher %}
                  {% if is_subscribed_to_publisher %}
                    <form method="post" action="{% url 'unsubscribe_publisher_from_article' article.pk %}" class="m-0">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-outline-danger">
                        Unsubscribe from publisher {{ article.publisher.name }}
                      </button>
                    </form>
                  {% else %}
                    <form method="post" action="{% url 'subscribe_publisher_from_article' article.pk %}" class="m-0">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-outline-primary">
                        Subscribe to publisher {{ article.publisher.name }}
                      </button>
                    </form>
                  {% endif %}
                {% endif %}
              </div>
            </div>

            <hr />
          {% endif %}

          <div class="mt-4 article-content lh-lg">
            {{ article.content|linebreaks }}
          </div>
        </div>
      </article>
    </div>
  </div>
{% endblock %}
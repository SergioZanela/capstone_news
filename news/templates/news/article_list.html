{% extends "base.html" %}

{% block title %}Articles | Capstone News{% endblock %}

{% block content %}
  <!-- Hero section -->
  <div class="page-hero shadow-sm mb-4">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <div class="text-uppercase small fw-semibold mb-2 opacity-75">
          Daily Brief
        </div>
        <h1 class="display-6 fw-bold hero-title">Top Headlines</h1>
        <p class="mb-0">
          Browse editor-approved stories submitted by journalists and published through Capstone News.
        </p>
      </div>

      <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
        {% if request.user.is_authenticated and request.user.role == "Journalist" %}
          <a href="{% url 'article_create' %}" class="btn btn-light btn-lg">
            Submit New Article
          </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Headline strip / ticker -->
  <div class="headline-strip mb-4">
    <div class="d-flex flex-column flex-md-row align-items-md-center gap-2">
      <div class="headline-strip-label">Breaking</div>
      <div class="headline-strip-text">
        Welcome to Capstone News — editor-approved content, journalist submissions, and a full Django + DRF workflow demo.
      </div>
    </div>
  </div>

  <!-- Quick actions -->
  <div class="d-flex flex-wrap gap-2 mb-4">
    <a href="{% url 'article_list' %}" class="btn btn-outline-primary btn-sm">
      All Articles
    </a>

    {% if request.user.is_authenticated and request.user.role == "Editor" %}
      <a href="{% url 'approval_queue' %}" class="btn btn-outline-secondary btn-sm">
        Editor Approval Queue
      </a>
    {% endif %}
  </div>

  {% if articles %}
    <!-- Featured article (first article) -->
    {% with featured=articles.0 %}
      <div class="card paper-card featured-article shadow-sm border-0 mb-4">
        <div class="card-body">
          <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
            <span class="badge text-bg-dark">Featured</span>

            {# Visual category badge (simple keyword-based template logic) #}
            {% with text=featured.title|lower %}
              {% if "economy" in text or "market" in text or "finance" in text %}
                <span class="category-badge category-economy">Economy</span>
              {% elif "tech" in text or "ai" in text or "software" in text %}
                <span class="category-badge category-tech">Tech</span>
              {% elif "politic" in text or "election" in text or "government" in text %}
                <span class="category-badge category-politics">Politics</span>
              {% elif "world" in text or "global" in text or "international" in text %}
                <span class="category-badge category-world">World</span>
              {% else %}
                <span class="category-badge category-general">General</span>
              {% endif %}
            {% endwith %}
          </div>

          <h2 class="featured-article-title h3 mb-2">{{ featured.title }}</h2>

          <p class="muted-meta mb-3">
            By {{ featured.author.username }}{% if featured.publisher %} • {{ featured.publisher.name }}{% endif %}
            • {{ featured.created_at|date:"d M Y, H:i" }}
          </p>

          {% if featured.content %}
            <p class="featured-excerpt mb-3">
              {{ featured.content|truncatechars:240 }}
            </p>
          {% endif %}

          <a href="{% url 'article_detail' featured.pk %}" class="btn btn-primary">
            Read featured article
          </a>
        </div>
      </div>
    {% endwith %}

    <!-- Remaining article cards -->
    <div class="row g-3">
      {% for a in articles %}
        {% if not forloop.first %}
          <div class="col-md-6 col-lg-4">
            <div class="card article-card paper-card h-100 border-0">
              <div class="card-body d-flex flex-column">
                <div class="d-flex flex-wrap gap-2 mb-2">
                  <span class="badge text-bg-light border">Approved</span>

                  {% with text=a.title|lower %}
                    {% if "economy" in text or "market" in text or "finance" in text %}
                      <span class="category-badge category-economy">Economy</span>
                    {% elif "tech" in text or "ai" in text or "software" in text %}
                      <span class="category-badge category-tech">Tech</span>
                    {% elif "politic" in text or "election" in text or "government" in text %}
                      <span class="category-badge category-politics">Politics</span>
                    {% elif "world" in text or "global" in text or "international" in text %}
                      <span class="category-badge category-world">World</span>
                    {% else %}
                      <span class="category-badge category-general">General</span>
                    {% endif %}
                  {% endwith %}
                </div>

                <h5 class="card-title">{{ a.title }}</h5>

                <p class="muted-meta mb-3">
                  By {{ a.author.username }}{% if a.publisher %} • {{ a.publisher.name }}{% endif %}
                </p>

                {% if a.content %}
                  <p class="card-text text-muted">
                    {{ a.content|truncatechars:120 }}
                  </p>
                {% endif %}

                <div class="mt-auto">
                  <a href="{% url 'article_detail' a.pk %}" class="btn btn-primary btn-sm">
                    Read article
                  </a>
                </div>
              </div>

              <div class="card-footer bg-white border-0 pt-0 pb-3 px-3">
                <small class="text-secondary">
                  Created: {{ a.created_at|date:"d M Y, H:i" }}
                </small>
              </div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

  {% else %}
    <div class="alert alert-light border shadow-sm" role="alert">
      No approved articles yet.
    </div>
  {% endif %}
{% endblock %}